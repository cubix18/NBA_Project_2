/*
Plik -> Tabela
regular_season_box_scores_2010_2024_part_1 -> NBA_DB.STAGING_NBA_DATA.STG_SEASON_PLAYER_STATS_V1
regular_season_box_scores_2010_2024_part_2 -> NBA_DB.STAGING_NBA_DATA.STG_SEASON_PLAYER_STATS_V2
regular_season_box_scores_2010_2024_part_3 -> NBA_DB.STAGING_NBA_DATA.STG_SEASON_PLAYER_STATS_V3
regular_season_box_scores_2010_2024_part_1 + regular_season_box_scores_2010_2024_part_2 + regular_season_box_scores_2010_2024_part_3 -> STG.SEASON_PLAYER_STATS
play_off_box_scores_2010_2024 -> NBA_DB.STAGING_NBA_DATA.STG_PLAYOFFS_TEAM_STATS

regular_season_totals_2010_2024 -> 
play_off_totals_2010_2024 -> 


*/

DROP TABLE NBA_DB.STAGING_NBA_DATA.STG_SEASON_TEAM_STATS;


SELECT 
        CAST(PERSONID AS NUMBER) AS PLAYER_ID
        , CAST(GAMEID AS NUMBER) AS GAME_ID
        , CAST(TEAMID AS NUMBER) AS TEAM_ID
        , SEASON_YEAR
        , TO_DATE(GAME_DATE) AS GAME_DATE
        , CONCAT(TEAMCITY, ' ', TEAMNAME) AS TEAM_NAME
        , TEAMCITY AS TEAM_CITY
        , TEAMNAME AS TEAM_NICKNAME
        , TEAMTRICODE AS TEAM_ABBREVATION
        , MATCHUP AS TEAM_MATCHUP
        , PERSONNAME AS PLAYER_FULL_NAME
        , COALESCE(POSITION, 'Unknown') AS PLAYER_POSITION
        , COALESCE(COMMENT, 'Unknown') AS PLAYER_COMMENT
        , CASE 
            WHEN LEFT(MINUTES, 2) LIKE '%:%' THEN TO_NUMBER(LEFT(MINUTES,1))
            WHEN LEFT(MINUTES, 2) NOT LIKE '%:%' THEN TO_NUMBER(LEFT(MINUTES, 2))
        END AS PLAYER_MINUTES_PLAYED
        , TO_NUMBER(RIGHT(MINUTES, 2)) AS PLAYER_SECONDS_PLAYED
        , FIELDGOALSMADE AS PLAYER_FG_MADE
        , FIELDGOALSATTEMPTED AS  PLAYER_FG_ATTEMPTED
        , FIELDGOALSPERCENTAGE AS PLAYER_FG_PCT
        , THREEPOINTERSMADE AS PLAYER_3PT_MADE
        , THREEPOINTERSATTEMPTED AS PLAYER_3PT_ATTEMPTED
        , THREEPOINTERSPERCENTAGE AS PLAYER_3PT_PCT
        , FREETHROWSMADE AS PLAYER_FT_MADE
        , FREETHROWSATTEMPTED AS PLAYER_FT_ATTEMPTED
        , FREETHROWSPERCENTAGE AS PLAYER_FT_PCT
        , REBOUNDSOFFENSIVE AS PLAYER_OFF_REB
        , REBOUNDSDEFENSIVE AS PLAYER_DEF_REB
        , REBOUNDSTOTAL AS PLAYER_TOTAL_REB
        , ASSISTS AS PLAYER_AST
        , STEALS AS PLAYER_STL
        , BLOCKS AS PLAYER_BLK
        , TURNOVERS AS PLAYER_TOV
        , FOULSPERSONAL AS PLAYER_FOULS
        , POINTS AS PLAYER_PTS
        , PLUSMINUSPOINTS AS PLAYER_PLUS_MINUS
        , 1 AS IS_VALID
        , TO_TIMESTAMP(CURRENT_TIMESTAMP ) AS LOAD_DATE
        , 'STAGING_NBA_DATA.STG_SEASON_PLAYER_STATS' AS SOURCE_TABLE
    from STG_SEASON_PLAYER_STATS;
    


SELECT 
        CAST(PERSONID AS NUMBER) AS PLAYER_ID
        , CAST(GAMEID AS NUMBER) AS GAME_ID
        , CAST(TEAMID AS NUMBER) AS TEAM_ID
        , SEASON_YEAR
        , TO_DATE(GAME_DATE) AS GAME_DATE
        , CONCAT(TEAMCITY, ' ', TEAMNAME) AS TEAM_NAME
        , TEAMCITY AS TEAM_CITY
        , TEAMNAME AS TEAM_NICKNAME
        , TEAMTRICODE AS TEAM_ABBREVATION
        , MATCHUP AS TEAM_MATCHUP
        , PERSONNAME AS PLAYER_FULL_NAME
        , COALESCE(POSITION, 'Unknown') AS PLAYER_POSITION
        , COALESCE(COMMENT, 'Unknown') AS PLAYER_COMMENT
        , CASE 
            WHEN LEFT(MINUTES, 2) LIKE '%:%' THEN TO_NUMBER(LEFT(MINUTES,1))
            WHEN LEFT(MINUTES, 2) NOT LIKE '%:%' THEN TO_NUMBER(LEFT(MINUTES, 2))
        END AS PLAYER_MINUTES_PLAYED
        , TO_NUMBER(RIGHT(MINUTES, 2)) AS PLAYER_SECONDS_PLAYED
        , FIELDGOALSMADE AS PLAYER_FG_MADE
        , FIELDGOALSATTEMPTED AS  PLAYER_FG_ATTEMPTED
        , FIELDGOALSPERCENTAGE AS PLAYER_FG_PCT
        , THREEPOINTERSMADE AS PLAYER_3PT_MADE
        , THREEPOINTERSATTEMPTED AS PLAYER_3PT_ATTEMPTED
        , THREEPOINTERSPERCENTAGE AS PLAYER_3PT_PCT
        , FREETHROWSMADE AS PLAYER_FT_MADE
        , FREETHROWSATTEMPTED AS PLAYER_FT_ATTEMPTED
        , FREETHROWSPERCENTAGE AS PLAYER_FT_PCT
        , REBOUNDSOFFENSIVE AS PLAYER_OFF_REB
        , REBOUNDSDEFENSIVE AS PLAYER_DEF_REB
        , REBOUNDSTOTAL AS PLAYER_TOTAL_REB
        , ASSISTS AS PLAYER_AST
        , STEALS AS PLAYER_STL
        , BLOCKS AS PLAYER_BLK
        , TURNOVERS AS PLAYER_TOV
        , FOULSPERSONAL AS PLAYER_FOULS
        , POINTS AS PLAYER_PTS
        , PLUSMINUSPOINTS AS PLAYER_PLUS_MINUS
        , 1 AS IS_VALID
        , TO_TIMESTAMP(CURRENT_TIMESTAMP ) AS LOAD_DATE
        , 'STAGING_NBA_DATA.STG_SEASON_TEAM_STATS' AS SOURCE_TABLE
    from  STG_PLAYOFFS_PLAYER_STATS;

SELECT *  from STG_PLAYOFFS_PLAYER_STATS;


SELECT 
    SEASON_YEAR
    , TEAM_NAME
    , TEAM_ABBREVIATION
    , TO_DATE(GAME_DATE) AS GAME_DATE
    , MATCHUP AS TEAM_MATCHUP
    , WL AS GAME_RESULT
    , MIN AS TEAM_MINUTES_PLAYED
    , FGM AS TEAM_FG_MADE
    , FGA AS TEAM_FG_ATTEMPTED
    , FG_PCT AS TEAM_FG_PCT
    , FG3M AS TEAM_3PT_MADE
    , FG3A AS TEAM_3PT_ATTEMPTED
    , FG3_PCT AS TEAM_3PT_PCT
    , FTM AS TEAM_FT_MADE
    , FTA AS TEAM_FT_ATTEMPTE
    , FT_PCT AS TEAM_FT_PCT
    , OREB AS TEAM_OFF_REB
    , DREB AS TEAM_DEF_REB
    , REB AS TEAM_TOTAL_REB
    , AST AS TEAM_ASSISTS
    , TOV AS TEAM_TO
    , STL AS TEAM_STEALS
    , BLK AS TEAM_BLOCKS
    , PF AS TEAM_PERSONAL_FOULS
    , PTS AS TEAM_POINTS
    , 1 AS IS_VALID
    , TO_TIMESTAMP(CURRENT_TIMESTAMP ) AS LOAD_DATE
    , 'STAGING_NBA_DATA.STG_SEASON_TEAM_STATS' AS SOURCE_TABLE
    FROM STG_PLAYOFFS_TEAM_STATS;

SELECT * FROM NBA_DB.STAGING_NBA_DATA.STG_SEASON_PLAYER_STATS;

SELECT * FROM NBA_DB.STAGING_NBA_DATA.STG_PLAYOFFS_PLAYER_STATS;

SELECT * FROM NBA_DB.STAGING_NBA_DATA.STG_SEASON_TEAM_STATS;

SELECT * FROM NBA_DB.STAGING_NBA_DATA.STG_PLAYOFFS_TEAM_STATS;