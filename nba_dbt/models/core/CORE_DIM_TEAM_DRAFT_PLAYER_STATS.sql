
WITH CTE AS (
    SELECT 
        CASE 
            WHEN TEAM_ABREVIATION = 'PHO' THEN 'PHX'
            WHEN TEAM_ABREVIATION = 'BRK' THEN 'BKN'
            ELSE TEAM_ABREVIATION
        END AS TEAM_ABREVIATION
    FROM {{ ref('CLS_DRAFT_PLAYER_STATS') }}
)

SELECT 
    DISTINCT MD5(DRAFT.TEAM_ABREVIATION || SEASON.TEAM_NAME) AS TEAM_ID
    , TEAM_ABREVIATION
    , SEASON.TEAM_NAME
    , SEASON.TEAM_CITY
FROM CTE DRAFT
LEFT JOIN (SELECT DISTINCT TEAM_ABBREVATION, TEAM_NAME, TEAM_CITY FROM {{ ref('CLS_SEASON_PLAYER_STATS') }} 
            WHERE TEAM_CITY <> 'LA') SEASON
ON DRAFT.TEAM_ABREVIATION = SEASON.TEAM_ABBREVATION
